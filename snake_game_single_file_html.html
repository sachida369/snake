<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Snake Game</title>
  <style>
    body { margin:0; font-family:Arial, sans-serif; background:#111; color:#0f0; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; }
    #menu, #gameOver, #win { text-align:center; }
    canvas { background:#000; display:block; margin:10px auto; }
    button { padding:10px 20px; margin:5px; border:none; border-radius:8px; background:#0f0; color:#000; font-weight:bold; cursor:pointer; }
    button:hover { background:#5f5; }
    #dpad { display:none; margin-top:10px; }
    #dpad button { width:60px; height:60px; font-size:24px; margin:3px; }
    @media (max-width:768px) { #dpad { display:flex; flex-wrap:wrap; justify-content:center; width:200px; } }
  </style>
</head>
<body>
  <div id="menu">
    <h1>Snake Game</h1>
    <p>High Score: <span id="highScore">0</span></p>
    <label>Level: <input type="number" id="levelInput" min="1" max="10" value="1"></label><br><br>
    <label><input type="checkbox" id="soundToggle" checked> Sound On</label><br><br>
    <button onclick="startGame()">Start</button>
  </div>

  <canvas id="game" width="400" height="400" style="display:none"></canvas>

  <div id="gameOver" style="display:none">
    <h2>Game Over</h2>
    <p>Your Score: <span id="finalScore"></span></p>
    <p>High Score: <span id="finalHighScore"></span></p>
    <button onclick="showMenu()">Restart</button>
  </div>

  <div id="win" style="display:none">
    <h2>You Win! üéâ</h2>
    <p>Your Score: <span id="winScore"></span></p>
    <p>High Score: <span id="winHighScore"></span></p>
    <button onclick="showMenu()">Restart</button>
  </div>

  <div id="dpad">
    <div style="flex-basis:100%;text-align:center;">
      <button onclick="setDirection('UP')">‚¨ÜÔ∏è</button>
    </div>
    <div style="flex-basis:100%; display:flex; justify-content:center;">
      <button onclick="setDirection('LEFT')">‚¨ÖÔ∏è</button>
      <button onclick="setDirection('DOWN')">‚¨áÔ∏è</button>
      <button onclick="setDirection('RIGHT')">‚û°Ô∏è</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const box = 20;
    let snake, direction, food, score, level, speed, game, obstacles = [];

    const beep = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
    const crash = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
    const winJingle = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
    let soundOn = true;

    function showMenu(){
      document.getElementById("menu").style.display="block";
      document.getElementById("game").style.display="none";
      document.getElementById("gameOver").style.display="none";
      document.getElementById("win").style.display="none";
      document.getElementById("highScore").textContent = localStorage.getItem("snakeHighScore")||0;
    }

    function startGame(){
      score=0;
      level=parseInt(document.getElementById("levelInput").value)||1;
      direction="RIGHT";
      snake=[{x:9*box,y:10*box}];
      food={x:Math.floor(Math.random()*19+1)*box,y:Math.floor(Math.random()*19+1)*box};
      obstacles = generateObstacles(level);
      speed = 200 - (level-1)*15;
      soundOn=document.getElementById("soundToggle").checked;
      document.getElementById("menu").style.display="none";
      document.getElementById("gameOver").style.display="none";
      document.getElementById("win").style.display="none";
      canvas.style.display="block";
      clearInterval(game);
      game=setInterval(draw,speed);
    }

    function generateObstacles(lvl){
      let obs=[];
      if(lvl>2){
        for(let i=5;i<15;i++){ obs.push({x:i*box,y:5*box}); }
      }
      if(lvl>5){
        for(let i=5;i<15;i++){ obs.push({x:i*box,y:15*box}); }
      }
      if(lvl>8){
        for(let i=5;i<15;i++){ obs.push({x:5*box,y:i*box}); obs.push({x:15*box,y:i*box}); }
      }
      return obs;
    }

    document.addEventListener("keydown",e=>{
      if(e.key=="ArrowLeft" && direction!="RIGHT") direction="LEFT";
      else if(e.key=="ArrowUp" && direction!="DOWN") direction="UP";
      else if(e.key=="ArrowRight" && direction!="LEFT") direction="RIGHT";
      else if(e.key=="ArrowDown" && direction!="UP") direction="DOWN";
    });

    function setDirection(dir){ if(!(dir==="LEFT"&&direction==="RIGHT") && !(dir==="RIGHT"&&direction==="LEFT") && !(dir==="UP"&&direction==="DOWN") && !(dir==="DOWN"&&direction==="UP")) direction=dir; }

    function collision(head,array){ return array.some(seg=>head.x===seg.x && head.y===seg.y); }

    function draw(){
      ctx.fillStyle="#000"; ctx.fillRect(0,0,canvas.width,canvas.height);
      for(let o of obstacles){ ctx.fillStyle="#555"; ctx.fillRect(o.x,o.y,box,box); }
      for(let i=0;i<snake.length;i++){ ctx.fillStyle=(i==0)?"lime":"green"; ctx.fillRect(snake[i].x,snake[i].y,box,box); }
      ctx.fillStyle="red"; ctx.fillRect(food.x,food.y,box,box);

      let snakeX=snake[0].x; let snakeY=snake[0].y;
      if(direction=="LEFT") snakeX-=box;
      if(direction=="UP") snakeY-=box;
      if(direction=="RIGHT") snakeX+=box;
      if(direction=="DOWN") snakeY+=box;

      if(snakeX==food.x && snakeY==food.y){
        score++;
        if(soundOn) beep.play();
        food={x:Math.floor(Math.random()*19+1)*box,y:Math.floor(Math.random()*19+1)*box};
        if(score>=level*5){
          clearInterval(game);
          if(level>=10){
            if(soundOn) winJingle.play();
            winGame();
          } else {
            level++;
            startGame();
          }
        }
      } else { snake.pop(); }

      let newHead={x:snakeX,y:snakeY};
      if(snakeX<0 || snakeY<0 || snakeX>=canvas.width || snakeY>=canvas.height || collision(newHead,snake) || collision(newHead,obstacles)){
        clearInterval(game);
        if(soundOn) crash.play();
        endGame();
        return;
      }
      snake.unshift(newHead);
      ctx.fillStyle="white"; ctx.fillText("Score: "+score,box,box);
      ctx.fillText("Level: "+level,canvas.width-80,box);
    }

    function endGame(){
      document.getElementById("game").style.display="none";
      document.getElementById("gameOver").style.display="block";
      document.getElementById("finalScore").textContent=score;
      let hs = localStorage.getItem("snakeHighScore")||0;
      if(score>hs){ localStorage.setItem("snakeHighScore",score); hs=score; }
      document.getElementById("finalHighScore").textContent=hs;
    }

    function winGame(){
      document.getElementById("game").style.display="none";
      document.getElementById("win").style.display="block";
      document.getElementById("winScore").textContent=score;
      let hs = localStorage.getItem("snakeHighScore")||0;
      if(score>hs){ localStorage.setItem("snakeHighScore",score); hs=score; }
      document.getElementById("winHighScore").textContent=hs;
    }

    showMenu();
  </script>
</body>
</html>
